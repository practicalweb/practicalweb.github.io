
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PracticalWeb Ltd</title>
  <meta name="author" content="Sean Burlington">

  
  <meta name="description" content="Just got a new UPS and it’s working nicely :-) Running on Debian Etch I had to upgrade the NUT package but this
worked very simply by bringing in the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.practicalweb.co.uk/posts/22">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="PracticalWeb Ltd" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3381543-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">PracticalWeb Ltd</a></h1>
  
    <h2>Websites that work for you.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/01/17/apc-back-ups-cs-500ei-and-debian-etch/">APC Back-UPS CS 500Ei and Debian Etch</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2008-01-17T00:00:00+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2008</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just got a new UPS and it’s working nicely :-)</p>

<div class="post-entry">
<p>
Running on Debian Etch I had to upgrade the NUT package but this
worked very simply by bringing in the one from Lenny (in testing)
</p>
<p>
added to /etc/apt/sources.list<br />
deb-src http://ftp.uk.debian.org/debian/ lenny main contrib non-free
</p>
<p>
then ran<br />
apt-get build-dep nut
</p>
<p>
as normal user<br />
apt-get source nut<br />
cd to nut dir<br />
dpkg-buildpackage -rfakeroot -uc -b
</p>
<p>
then as root installed the .deb created 
</p>
<p>
After that it was just a case of reading the docs and configuring.
</p>
<p>
I’m using the UPS for my desktop and monitor - it’s drawing 25% load
with a predicted battery runtime of about 45minutes (which I don’t
quite believe)
</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/01/16/restoring-an-old-postgresql-database/">Restoring an Old Postgresql Database</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2008-01-16T00:00:00+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2008</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve just had cause to restore a two year old backup of a database I haven’t used in a while</p>

<div class="post-entry">
<p>
Since then postgresql (on Debian at least) has added the option to
have multiple ‘clusters’ and multple versions running on the same
machine.
</p>
<p>
Fortunately the old version (7.4) was still available<br />
</p>
<p>
Steps
</p>
<ul>
    <li>restore /var/lib/postgresql/data</li>
    <li>restore /etc/postgresql</li>
    <li>mkdir /var/lib/postgresql/7.4</li>
    <li>mv /var/lib/postgresql/data /var/lib/postgresql/7.4/</li>
    <li>chown -R postgres.postgres  /var/lib/postgresql/7.4/</li>
    <li>pg_createcluster 7.4 data (this moves the old data into the new structure)</li>
    <li>pg_upgradecluster 7.4 data (upgrade the data to the latest postgres version installed)</li>
</ul>
<p>
Other issues: my old data was in a character set I didn’t have installed as I now use UTF8
</p>
<p>
I had to add en_GB ISO-8859-1 to /etc/locale.gen
</p>
<p>
and run locale-gen
</p>
<p>
But I now have access to my old data in both old and new server
versions (I’ll probably delete the old one but it might be useful for
testing)
</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/01/11/creating-a-patch-from-cvs/">Creating a Patch From Cvs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2008-01-11T00:00:00+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2008</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>specifically
I wanted to create a patch equal to the changes between two versions of
Drupal - but it turns out that a packaging script adds some info to
releases that isn’t in the cvs version so this doesn’t quite do what I
wanted.</p>

<div class="post-entry">
<p>
it’s still useful though …
</p>
<ul>
    <li>checkout the current version</li>
    <li>generate the patch as a diff between the previos version and this one</li>
    <li>optionally run a diff to compare the two versions (cvs and svn) to check they are the same</li>
</ul>
<p>
<br />
cvs -z6 -d:pserver:anonymous:anonymous@cvs.drupal.org:/cvs/drupal checkout -d drupal5 -r DRUPAL-5-6 drupal
</p>
<p>
cd drupal<br />
cvs diff -N -u -rDRUPAL-5-5 -r DRUPAL-5-6 &gt; ../drupal-5-5-to-5-6.txt<br />
cd ..<br />
diff -r drupal-cvs/ drupal | grep -v .svn | grep -v CVS | less<br />
</p>
<p>
In eclipse open the svn drupal project - go to teams - apply patch
</p>
<p>
and (except for the packaging stuff) you have an updated drupal for your svn repository.
</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/01/08/sifr3-fancy-fonts-on-web-pages/">sIFR3 - Fancy Fonts on Web Pages</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2008-01-08T00:00:00+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2008</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve just been working on a site that uses <a href="http://wiki.novemberborn.net/sifr/What+is+sIFR">sIFR</a>
to incorporate a specific font into the design - this works very well
generally but we had a problem where links did not work on the MAC or
in IE6.<br /></p>

<div class="post-entry">
<p>
<br />
This problem seems to have been solved in sIFR3 which also brings much
more flexibility - styles can change within the replaced text, filters
like drop shadow area available - and actions like mouseover can
trigger javascript callbacks.
</p>
<p>
The only thing I couldn’t see a way of doing was changing the background color of a link on hover…
</p>
<p>
Documentation is at : <a href="http://wiki.novemberborn.net/sifr3/">wiki.novemberborn.net/sifr3/</a>
</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/01/03/version-control-and-drupal/">Version Control and Drupal</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2008-01-03T00:00:00+00:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2008</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve
been using open source software and developing php for a decade or so
now - but until recently the two have been fairly seperate.</p>

<div class="post-entry">
<p>
Now I’m working on Drupal I need to keep track of my work - and merge in the changes from ‘upstream’.
</p>
<p>
here’s the useful info I found …
</p>
<p>
Drupal advise<br />
Drupal.org » Forum » Support » Post installation : Repository setup<br />
<a href="http://drupal.org/node/118936">http://drupal.org/node/118936</a>
</p>
<p>
Vendor Branches<br />
<a href="http://svnbook.red-bean.com/en/1.0/ch07s04.html">http://svnbook.red-bean.com/en/1.0/ch07s04.html</a>
</p>
<p>
Subversion Externals<br />
<a href="http://svnbook.red-bean.com/en/1.0/ch07s03.html">http://svnbook.red-bean.com/en/1.0/ch07s03.html</a>
</p>
<p>
svn load dirs (need for upgrading the vendor release)<br />
<a href="http://docs.ofbiz.org/display/OFBIZ/SVN+Tips+-+svn_load_dirs+Vendor+Branch">http://docs.ofbiz.org/display/OFBIZ/SVN+Tips+-+svn_load_dirs+Vendor+Branch</a>
</p>
<p>
CVS to subversion scripts<br />
<a href="http://drupal.org/node/71232">http://drupal.org/node/71232</a>
</p>
<p>
Update Status (to track new modules)<br />
<a href="http://drupal.org/project/update_status">http://drupal.org/project/update_status</a>
</p>
<p>
In the end I’ve decided to put all my projects in one repository
(I’ll need to upgrade trac 0.11 soon to host project management on a
per project basis)
</p>
<p>
Each project has a copy of drupal core + contrib modules I plan to use svn:externals to link in my own modules
</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/12/02/configure-apache-ssl-and-subversion-in-debian-in-683-seconds/">Configure Apache SSL and Subversion in Debian in 683 Seconds</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2007-12-02T00:00:00+00:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2007</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="post-entry">
<p>
Shamelessly copied from:
</p>
<p>
<a href="http://www.geocities.com/arhuaco/doc/subversion/apache-subversion-in-debian.html">www.geocities.com/arhuaco/doc/subversion/apache-subversion-in-debian.html</a>
</p>
<p>
Configure Apache SSL and Subversion in Debian in 683 seconds
</p>
<p>
This just saved me lots of time and I want to keep a copy for later - just in case…
</p>
<p>
Mar 26 2005
</p>
<p>
(The apache2+SSL part was taken from the article Debian, Apache2 and SSL by Ian Miller)
</p>
<p>
Debian Sarge comes with an apache2 package. I thought I’d give this
a go to get it working with a self signed SSL certificate. However, I
had little idea of what I was doing. Eventually I worked it out - and
it’s easy:
</p>
<p>
    * Login or su as root<br />
* Run:
</p>
<p>
apt-get install apache2
</p>
<p>
    * Run the script
</p>
<p>
apache2-ssl-certificate
</p>
<p>
and tell it what it wants to know.
</p>
<p>
    * Make a copy of ‘/etc/apache2/sites-available/default’ - call it something like ’ssl’
</p>
<p>
 * Make a sym-link to this new site configuration from
/etc/apache2/sites-enabled/ You will see this is already done for
‘default’.
</p>
<p>
    * Add a
</p>
<p>
Listen 443
</p>
<p>
to /etc/apache2/ports.conf
</p>
<p>
 * Edit /etc/apache2/sites-available/ssl (or whatever you called
your new ssl site’s config) and change port 80 in the name of the site
to 443. Also change the virtual host setting. Add the lines “SSLEngine
On”, “SSLCertificateFile /etc/apache2/ssl/apache.pem” and “LoadModule
ssl_module /usr/lib/apache2/modules/mod_ssl.so”. My config file reads:
</p>
<p>
NameVirtualHost *:443<br />
<br />
LoadModule ssl_module /usr/lib/apache2/modules/mod_ssl.so<br />
SSLEngine On<br />
SSLCertificateFile /etc/apache2/ssl/apache.pem
</p>
<p>
 …
</p>
<p>
    * Restart apache2
</p>
<p>
/etc/init.d/apache2 restart
</p>
<p>
    * HTTPS should work.
</p>
<p>
Try: https://hostname/
</p>
<p>
    * Now, let’s start with subversion.
</p>
<p>
apt-get install libapache2-svn subversion subversion-tools
</p>
<p>
    * Create a repository.
</p>
<p>
cd /home<br />
mkdir svn<br />
chown www-data svn<br />
su www-data -c “svnadmin create svn/src”
</p>
<p>
    * If you let your users run as www-data they will be able to write to your repository!
</p>
<p>
    * Become root again and add the following lines our apache configuration (ssl), inside of the VirtualHost declaration.
</p>
<p>
 <br />
DAV svn<br />
SVNPath /home/svn/src
</p>
<p>
    AuthType Basic<br />
AuthName “My Subversion Repository”<br />
AuthUserFile /home/svn/.dav_svn.passwd<br />
Require valid-user<br />
</p>
<p>
    * Use this instead of “Require valid-user” if you don’t want to use passwords for read-only access
</p>
<p>
  <br />
Require valid-user<br />
</p>
<p>
    * Let’s add some users.
</p>
<p>
su www-data -c “htpasswd2 -c -m /home/svn/.dav_svn.passwd galactus”
</p>
<p>
    * Add another user (don’t use -c or it will recreate the file)
</p>
<p>
su www-data -c “htpasswd2 -m /home/svn/.dav_svn.passwd ceruno”<br />
su www-data -c “htpasswd2 -m /home/svn/.dav_svn.passwd n”
</p>
<p>
    * Test the repository
</p>
<p>
 1. Using your browser. Load https://hostname/svn/src/ in your
browser. Replace hostname with your host name or ip. You will get
something like:
</p>
<p>
Revision 0: /<br />
Powered by Subversion version 1.1.3 (r12730).
</p>
<p>
   1. From the command line:
</p>
<p>
 svn –username n import checkers https://localhost/svn/src -m “initial import”<br />
Authentication realm:  My Subversion Repository<br />
Password for ‘n’:<br />
Adding         checkers/trunk<br />
Adding         checkers/trunk/gendelta.pl<br />
Adding         checkers/site<br />
Adding         checkers/branches<br />
Adding         checkers/tags
</p>
<p>
Committed revision 1.
</p>
<p>
    * Load from the browser again.
</p>
<p>
Revision 1: /<br />
* branches/<br />
* site/<br />
* tags/<br />
* trunk/<br />
Powered by Subversion version 1.1.3 (r12730).
</p>
<p>
    * And that’s all so far.
</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/11/12/raid-protecting-my-data/">RAID - Protecting My Data</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2007-11-12T00:00:00+00:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2007</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
I’ve
had too many hard disk failures over the years and decided to use RAID
to ensure that all my photos, email and work are always copied to two
disks so that if any one of them fails I don’t lose anything. 
</p>


<p>
Recently I was upgrading my system and accidentally unplugged one of
these disks - I didn’t even notice until I got an automatic email
warning me that one of the disks wasn’t working! 
</p>


<p>
Plugging it back in and getting it working was pretty easy!
</p>


<p>
note to future self - the commands were 
</p>


<p>
show what is happening<br />
mdadm &#8211;query &#8211;detail /dev/md1 
</p>


<p>
add drives back into array<br />
mdadm &#8211;manage &#8211;add /dev/md0 /dev/hdc1<br />
mdadm &#8211;manage &#8211;add /dev/md1 /dev/hdc2
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2005/08/09/full-text-searching-on-postgresql-with-tsearch2/">Full Text Searching on PostgreSQL With Tsearch2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2005-08-09T00:00:00+01:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2005</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve just been experimenting with text searches: <a href="http://www.sai.msu.su/%7Emegera/postgres/gist/tsearch/V2/docs/tsearch-V2-intro.html"><a href="http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/docs/tsearch-V2-intro.html">http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/docs/tsearch-V2-intro.html</a></a></p>

<div class="post-entry">
<p>
It’s worth noting that most of the commands in the above tutorial
assume you are running as the database superuser, this is required to
run the setup script but then you can grant permission for an ordinary
user for the search tables (in the public schema names starting pg_ts_)
</p>
<p>
The search will only match words that start with the search term,
but is very fast and can search over several columns by maintaining a
combined index.
</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2005/08/07/importing-legacy-data-for-use-as-an-ldap-addressbook/">Importing Legacy Data for Use as an LDAP Addressbook</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2005-08-07T00:00:00+01:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2005</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This
is something I played around with ages ago and didn’t make notes on -
now I’m doing a little more work pulling together what I learned then
along with some new stuff.</p>

<div class="post-entry">
<p>
In /etc/ldap/slapd.conf
</p>
<p>
Pull in some standard schemas
</p>
<pre>
include         /etc/ldap/schema/core.schema
include         /etc/ldap/schema/cosine.schema
include         /etc/ldap/schema/nis.schema
include         /etc/ldap/schema/inetorgperson.schema
include         /etc/ldap/schema/mozillaOrgPerson_V0.6.1.schema
</pre>
<p>
define what are effectively the names of your database, the admin username and the admin password, <br />
I’ve used my domain name as the database name as this more or less
guarantees the name is globally unique which can be useful, it’s also
easy to remember<br />
The password is generated with  /usr/bin/ldappasswd (part of the ldap-utils package)
</p>
<pre>
# Define the root suffix you serve.
suffix          &quot;dc=uncertainty,dc=org,dc=uk&quot;
# Define a root DN for superuser privileges.
rootdn                &quot;cn=Manager,dc=uncertainty,dc=org,dc=uk&quot;
# Define the password used with rootdn.
rootpw    ***********
</pre>
<p>
Define read permissions as required for other users, set loglevel to
256 if you want to view queries being sent to the server for debugging
</p>
<p>
Next create an ldif file that defines your first ?container? followed by any entries
</p>
<pre>
# Organization for Example Corporation
dn: dc=uncertainty,dc=org,dc=uk
objectClass: dcObject
objectClass: organization
dc: uncertainty
o: Example Corporation
description: The Example Corporation
dn: cn=someone,dc=uncertainty,dc=org,dc=uk
cn: someone
sn: someone
postalCode: AB12 XQ7
homePostalAddress: a place somewhere
mail: fake@test.bla
objectclass: inetOrgPerson
</pre>
<p>
This can be entered with the command
</p>
<pre>
ldapadd -x -D &quot;cn=Manager,dc=uncertainty,dc=org,dc=uk&quot; -W -f  test.ldif
</pre>
<p>
which will prompt for the password created earlier
</p>
<p>
ldapmodify can be used to add (-a) or  update (default) use option -c to keep going even if errors are encountered
</p>
<p>
Configure your client to use Base DN as specified earlier - in my case dc=uncertainty,dc=org,dc=uk
</p>
<h2>Useful links</h2>
<p>
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=116692">Bug 116692<br />
Define official Mozilla LDAP schema extension</a><br />
<a href="http://www.yolinux.com/TUTORIALS/LinuxTutorialLDAP-GILSchemaExtension.html">YoLinux: OpenLDAP 2.x Schema Extension to support MS/Outlook, Netscape 4.5+</a>
</p>
<p>
<a href="http://www.openldap.org/faq/data/cache/294.html">OpenLDAP Faq-O-Matic : MS Outlook: How Do LDAP Attributes Map to Address Book Fields?</a>
</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2005/04/09/connecting-tomcat-5-to-apache-2-using-mod-jk-1-2-in-a-virtual-host-and-using-debian/">Connecting Tomcat 5 to Apache 2 Using Mod Jk 1.2 (in a Virtual Host and Using Debian)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2005-04-09T00:00:00+01:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2005</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This
is fairly well documented on the apache site - but you have to pull
info together from a few pages and the importance of virtual servers is
easy to miss.</p>

<div class="post-entry">
<ol>
    <li>
    <p>
    Make sure you have the development package for apache (you need
    apxs2 installed) taking care to get the right apache2-dev package<br />
    I ran apt-get install apache2-prefork-dev
    </p>
    </li>
    <li>
    <p>
    <a href="http://www.apache.org/dist/jakarta/tomcat-connectors/jk/source/">Download the Source</a> (so that you can compile for your platform and your version of apache)
    </p>
    </li>
    <li>
    <p>
    extract the jk-connector source
    </p>
    </li>
    <li>
    <p>
    Change to the build directory<br />
    cd jakarta-tomcat-connectors-1.2.10-src/jk/native
    </p>
    </li>
    <li>
    <p>
    clean with make clean
    </p>
    </li>
    <li>
    <p>
    Configure for your apache with ./configure &#8211;with-apxs=/usr/bin/apxs2
    </p>
    </li>
    <li>
    <p>
    Build the module with make
    </p>
    </li>
    <li>
    <p>
    Switch to root
    </p>
    </li>
    <li>
    <p>
    Copy the module to the apache modules directory cp apache-2.0/mod_jk.so /usr/lib/apache2/modules/
    </p>
    </li>
    <li>
    <p>
    Create a load module file for apache /etc/apache2/mods-available/mod_jk.load<br />
    This file should just contain the line<br />
    LoadModule jk_module   /usr/lib/apache2/modules/mod_jk.so
    </p>
    </li>
    <li>
    <p>
    Create a Conf module /etc/apache2/mods-available/mod_jk.conf<br />
    Mine looks like this (still at the testing stage)
    </p>
    <pre>
        JkWorkersFile /etc/apache2/workers.properties
    # Where to put jk logs
    JkLogFile     /tmp/mod_jk.log
    # Set the jk log level [debug/error/info]
    JkLogLevel  debug
    JkLogStampFormat &quot;[%a %b %d %H:%M:%S %Y] &quot;
    # JkOptions indicate to send SSL KEY SIZE,
    JkOptions     +ForwardKeySize +ForwardURICompat -ForwardDirectories
    # JkRequestLogFormat set the request format
    JkRequestLogFormat     &quot;%w %V %T&quot;
    </pre>
    <p>
    The <a href="http://jakarta.apache.org/tomcat/connectors-doc/howto/apache.html">official howto</a>
    suggests that JkRequestLogFormat and JkMount can be configured on a per
    virtual host basis - the other directives seem to be required in the
    main apache config.
    </p>
    </li>
    <li>
    <p>
    enable these modules in the usual way by creating symlinks from mods-enabled to the files in mods-available
    </p>
    </li>
    <li>
    <p>
    Create a workers file (in the place specified above) /etc/apache2/workers.properties
    </p>
    <pre>
        workers.tomcat_home=/usr/local/jakarta-tomcat-5.0.18/
    workers.java_home=/usr/local/java/j2sdk1.4.2_04/
    ps=/
    # Define 1 real worker using ajp13
    worker.list=worker1
    # Set properties for worker1 (ajp13)
    worker.worker1.type=ajp13
    worker.worker1.host=127.0.0.1
    worker.worker1.port=8009
    worker.worker1.lbfactor=50
    worker.worker1.cachesize=10
    worker.worker1.cache_timeout=600
    worker.worker1.socket_keepalive=1
    worker.worker1.reclycle_timeout=300
    </pre>
    <p>
    I’m not sure if the first 3 lines are required.
    </p>
    </li>
    <li>
    <p>
    Add a line in your Virtual host config such as<br />
    JkMount  /manager/html/* worker1
    </p>
    </li>
    <li>
    <p>
    Restart apache
    </p>
    </li>
    <li>
    <p>
    You should now be able to access your tomcat app as http://yourvirtualhost/manager/html/<br />
    (or whichever apps you have used
    </p>
    </li>
</ol>
<p>
<a href="http://jakarta.apache.org/tomcat/connectors-doc/howto/quick.html">the official quick guide to workers</a>
</p>
<h2>Trouble Shooting</h2>
<p>
I had problems getting this working, it turned out to be because I
hade configured the jk directives in the vitual host sectionm of my
apache config but the error messages were not helpful - I just got <br />
jk_handler::mod_jk.c (1983): Could not find a worker for worker name=worker1
</p>
<h3>Testing the setup</h3>
<p>
Can you telnet to the apj13 port?<br />
telnet 127.0.0.1 8009<br />
You should see something like
</p>
<pre>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'
</pre>
<p>
If this works your tomcat setup is OK - if not check your server.xml settings.
</p>
<p>
NB you can restrict tomcat to only listen to localhost by adding an address parameter like
</p>
<pre>
&lt;Connector address=&quot;127.0.0.1&quot; port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; protocolHandlerClassName=&quot;org.apache.jk.server.JkCoyoteHandler&quot; redirectPort=&quot;8443&quot;&gt;
</pre>
<p>
When I had tomcat running correctly and mod jk configured this is the output in my jk log
</p>
<pre>
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] do_shm_open::jk_shm.c (213): Using process memory as shared memory
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] init_jk::mod_jk.c (2341): Initialized shm:memory
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] uri_worker_map_open::jk_uri_worker_map.c (324): rule map size is 0
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] build_worker_map::jk_worker.c (219): creating worker worker1
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] wc_create_worker::jk_worker.c (125): about to create instance worker1 of aj
p13
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] wc_create_worker::jk_worker.c (138): about to validate and init worker1
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_validate::jk_ajp_common.c (1781): worker worker1 contact is '127.0.0.1:
8009'
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1870): setting socket keepalive to 1
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1909): setting socket timeout to -1
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1913): setting socket buffer size to 0
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1917): setting connection recycle timeout to 0
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1921): setting cache timeout to 600
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1925): setting connect timeout to 0
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1929): setting reply timeout to 0
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1933): setting prepost timeout to 0
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1937): setting recovery opts to 0
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_init::jk_ajp_common.c (1941): setting number of retries to 3
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] ajp_create_endpoint_cache::jk_ajp_common.c (1818): setting connection cache
size to 10
[Sat Apr 09 22:21:48 2005] [23190:16512] [debug] build_worker_map::jk_worker.c (231): removing old worker1 worker
[Sat Apr 09 22:21:49 2005] [23190:16512] [debug] jk_cleanup_shmem::mod_jk.c (1735): Shmem cleanup
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] do_shm_open::jk_shm.c (213): Using process memory as shared memory
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] init_jk::mod_jk.c (2341): Initialized shm:memory
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] uri_worker_map_open::jk_uri_worker_map.c (324): rule map size is 0
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] build_worker_map::jk_worker.c (219): creating worker worker1
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] wc_create_worker::jk_worker.c (125): about to create instance worker1 of aj
p13
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] wc_create_worker::jk_worker.c (138): about to validate and init worker1
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_validate::jk_ajp_common.c (1781): worker worker1 contact is '127.0.0.1:
8009'
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1870): setting socket keepalive to 1
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1909): setting socket timeout to -1
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1913): setting socket buffer size to 0
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1917): setting connection recycle timeout to 0
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1921): setting cache timeout to 600
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1925): setting connect timeout to 0
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1929): setting reply timeout to 0
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1933): setting prepost timeout to 0
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1937): setting recovery opts to 0
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_init::jk_ajp_common.c (1941): setting number of retries to 3
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] ajp_create_endpoint_cache::jk_ajp_common.c (1818): setting connection cache
size to 10
[Sat Apr 09 22:21:49 2005] [23191:16512] [debug] build_worker_map::jk_worker.c (231): removing old worker1 worker
[Sat Apr 09 22:21:50 2005] [23192:16512] [debug] do_shm_open::jk_shm.c (213): Using process memory as shared memory
[Sat Apr 09 22:21:50 2005] [23192:16512] [debug] jk_child_init::mod_jk.c (2307): Attached shm:memory
[Sat Apr 09 22:21:50 2005] [23192:16512] [debug] jk_child_init::mod_jk.c (2317): Initialized mod_jk/1.2.10
[Sat Apr 09 22:21:50 2005] [23193:16512] [debug] do_shm_open::jk_shm.c (213): Using process memory as shared memory
[Sat Apr 09 22:21:50 2005] [23193:16512] [debug] jk_child_init::mod_jk.c (2307): Attached shm:memory
[Sat Apr 09 22:21:50 2005] [23193:16512] [debug] jk_child_init::mod_jk.c (2317): Initialized mod_jk/1.2.10
[Sat Apr 09 22:21:50 2005] [23194:16512] [debug] do_shm_open::jk_shm.c (213): Using process memory as shared memory
[Sat Apr 09 22:21:50 2005] [23194:16512] [debug] jk_child_init::mod_jk.c (2307): Attached shm:memory
[Sat Apr 09 22:21:50 2005] [23194:16512] [debug] jk_child_init::mod_jk.c (2317): Initialized mod_jk/1.2.10
[Sat Apr 09 22:21:50 2005] [23195:16512] [debug] do_shm_open::jk_shm.c (213): Using process memory as shared memory
[Sat Apr 09 22:21:50 2005] [23195:16512] [debug] jk_child_init::mod_jk.c (2307): Attached shm:memory
[Sat Apr 09 22:21:50 2005] [23195:16512] [debug] jk_child_init::mod_jk.c (2317): Initialized mod_jk/1.2.10
[Sat Apr 09 22:21:50 2005] [23196:16512] [debug] do_shm_open::jk_shm.c (213): Using process memory as shared memory
[Sat Apr 09 22:21:50 2005] [23196:16512] [debug] jk_child_init::mod_jk.c (2307): Attached shm:memory
[Sat Apr 09 22:21:50 2005] [23196:16512] [debug] jk_child_init::mod_jk.c (2317): Initialized mod_jk/1.2.10
</pre>
<p>
The above appeared on apache startup - before any requests were made.
</p>
<p>
Even when it wasn’t working I could see apache trying to map requests to tomcat
</p>
<pre>
[Sat Apr 09 22:24:39 2005] [23193:16512] [debug] map_uri_to_worker::jk_uri_worker_map.c (455): Attempting to map URI '/manager/html/' from 0 maps
</pre>
</div>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/23">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/21">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/27/add-annotations-to-grafana-via-elasticsearch/">Add Annotations to Grafana via Elasticsearch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/18/git-stash-save-message/">Git Stash Save Message</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/13/puppet-vs-ansible/">Puppet vs Ansible</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/11/ssl-problems-in-jmeter-and-java-1-dot-7/">SSL Problems in Jmeter and Java 1.7</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/03/local-yum-cache-repo/">Local Yum Cache Repo</a>
      </li>
    
  </ul>
</section>


<section>
     <h1>Twitter</h1>
            <a class="twitter-timeline"  href="https://twitter.com/seanburlington" data-widget-id="524302229054832640">Tweets by @seanburlington</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          
          
 </section>




<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101485141680594541671?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<script>
  (function() {
    var cx = '006368662332329297011:kk0vbscc1zc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo">
<p>&copy; copyright 2015 - PracticalWeb Ltd all rights reserved</p>

<p>UK registered company number 06427950</p>

</footer>
  



<script type="text/javascript">
// sean 3

      var disqus_shortname = 'practicalweb';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
